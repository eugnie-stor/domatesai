<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domates AI Hacılar Pro Max</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #e74c3c;
            --secondary-color: #c0392b;
            --accent-color: #f1c40f;
            --dark-color: #1e1e1e;
            --light-color: #2d2d2d;
            --text-color: #f0f0f0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --border-radius: 12px;
            --navbar-width: 70px;
            --transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: var(--transition);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark-color);
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }
        <!-- Mevcut body açılış etiketinden sonra en üste ekle -->
<div class="profile-container">
    <div class="profile-card">
        <div class="profile-info" id="profile-info">
            <div class="profile-picture">
                <i class="fas fa-user"></i>
            </div>
            <div class="profile-name">Misafir</div>
        </div>
        <div class="profile-actions" id="profile-actions">
            <button class="btn btn-primary" id="login-btn">Giriş Yap</button>
            <button class="btn btn-secondary" id="register-btn">Kayıt Ol</button>
        </div>
    </div>
</div>

<!-- Mevcut modal'ların sonrasına bu modal'ları ekle -->
<!-- Giriş Modal -->
<div class="modal" id="login-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-sign-in-alt"></i> Giriş Yap</h3>
            <button class="close-modal" id="close-login-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="login-email">E-posta</label>
                <input type="email" id="login-email" class="form-control">
            </div>
            <div class="form-group">
                <label for="login-password">Şifre</label>
                <input type="password" id="login-password" class="form-control">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancel-login">İptal</button>
            <button class="btn btn-primary" id="submit-login">Giriş Yap</button>
        </div>
    </div>
</div>

<!-- Kayıt Modal -->
<div class="modal" id="register-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-user-plus"></i> Kayıt Ol</h3>
            <button class="close-modal" id="close-register-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="register-username">Kullanıcı Adı</label>
                <input type="text" id="register-username" class="form-control">
            </div>
            <div class="form-group">
                <label for="register-email">E-posta</label>
                <input type="email" id="register-email" class="form-control">
            </div>
            <div class="form-group">
                <label for="register-password">Şifre</label>
                <input type="password" id="register-password" class="form-control">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancel-register">İptal</button>
            <button class="btn btn-primary" id="submit-register">Kayıt Ol</button>
        </div>
    </div>
</div>
        /* Responsive Sağ Navbar */
        .right-navbar {
            width: var(--navbar-width);
            background-color: var(--dark-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            box-shadow: var(--shadow);
            z-index: 10;
            position: fixed;
            right: 0;
        }
        
        /* Mobil için navbar */
        @media (max-width: 768px) {
            .right-navbar {
                bottom: 0;
                top: auto;
                height: auto;
                width: 100%;
                flex-direction: row;
                justify-content: space-around;
                padding: 10px 0;
            }
            
            .nav-item {
                margin: 0 5px;
            }
            
            .nav-item .tooltip {
                bottom: 60px;
                right: auto;
                left: 50%;
                transform: translateX(-50%);
            }
        }
        
        /* Tablet için navbar */
        @media (min-width: 769px) and (max-width: 1024px) {
            .right-navbar {
                width: 60px;
            }
            
            .nav-item {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
        }
        
        /* Büyük ekranlar için navbar */
        @media (min-width: 1921px) {
            .right-navbar {
                width: 100px;
            }
            
            .nav-item {
                width: 70px;
                height: 70px;
                font-size: 28px;
                margin: 20px 0;
            }
        }

        .nav-item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 12px 0;
            cursor: pointer;
            position: relative;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 20px;
        }
        
        .nav-item:hover {
            background-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .nav-item.active {
            background-color: var(--primary-color);
        }
        
        .nav-item .tooltip {
            position: absolute;
            right: 60px;
            background-color: var(--dark-color);
            color: white;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }
        
        .nav-item:hover .tooltip {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* Ana İçerik */
        .main-content {
            flex: 1;
            margin-right: var(--navbar-width);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* Responsive ana içerik */
        @media (max-width: 768px) {
            .main-content {
                margin-right: 0;
                margin-bottom: 70px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .main-content {
                margin-right: 60px;
            }
        }
        
        @media (min-width: 1921px) {
            .main-content {
                margin-right: 100px;
            }
        }

        /* Header */
        .header {
            background-color: var(--light-color);
            padding: 15px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            z-index: 5;
            position: relative;
        }
        
        .header-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-title i {
            color: var(--accent-color);
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .header-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--text-color);
            position: relative;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .header-btn:hover {
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            height: calc(100vh - 70px);
        }
        
        /* Responsive chat container */
        @media (max-width: 768px) {
            .chat-container {
                padding: 10px;
                height: calc(100vh - 140px);
            }
        }
        
        @media (min-width: 1921px) {
            .chat-container {
                max-width: 1600px;
            }
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 15px;
            scroll-behavior: smooth;
        }
        
        /* Responsive chat messages */
        @media (max-width: 768px) {
            .chat-messages {
                padding: 15px;
            }
        }

        .message {
            margin-bottom: 20px;
            max-width: 85%;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            margin-left: auto;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 18px;
            border-radius: 18px 18px 0 18px;
            box-shadow: var(--shadow);
            position: relative;
        }
        
        .user-message .message-actions {
            position: absolute;
            top: -15px;
            right: 0;
            display: none;
            gap: 5px;
        }
        
        .user-message:hover .message-actions {
            display: flex;
        }
        
        .message-action-btn {
            background-color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            color: var(--dark-color);
            font-size: 12px;
        }
        
        .message-action-btn:hover {
            background-color: var(--accent-color);
            color: white;
        }
        
        .ai-message {
            margin-right: auto;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 12px 18px;
            border-radius: 18px 18px 18px 0;
            box-shadow: var(--shadow);
            position: relative;
        }
        
        .message-time {
            display: block;
            font-size: 11px;
            margin-top: 5px;
            opacity: 0.7;
            text-align: right;
        }
        
        .typing-indicator {
            display: none;
            padding: 12px 18px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 18px 18px 18px 0;
            width: fit-content;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
        }
        
        .typing-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--text-color);
            margin: 0 3px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); background-color: var(--text-color); }
            30% { transform: translateY(-5px); background-color: var(--primary-color); }
        }
        
        /* Input Area */
        .input-area {
            display: flex;
            gap: 10px;
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: relative;
        }
        
        #user-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            font-size: 16px;
            outline: none;
            min-height: 50px;
            max-height: 150px;
            resize: none;
            overflow-y: auto;
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
        }
        
        #user-input:focus {
            border-color: var(--primary-color);
        }
        
        .input-actions {
            position: absolute;
            bottom: 70px;
            left: 15px;
            display: flex;
            gap: 10px;
            background-color: var(--light-color);
            padding: 10px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            opacity: 0;
            transform: translateY(10px);
            transition: var(--transition);
            z-index: 5;
        }
        
        .input-actions.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        .input-action-btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .input-action-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        #send-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            flex-shrink: 0;
        }
        
        #send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        /* Welcome Animation */
        .welcome-animation {
            text-align: center;
            margin: 30px 0;
            opacity: 0;
            animation: fadeIn 1s 0.5s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .tomato-icon {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transform: translateY(-20px);
            transition: var(--transition);
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-title {
            font-size: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .modal-body {
            margin-bottom: 25px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* File Upload */
        .file-upload-container {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .file-upload-container:hover {
            border-color: var(--primary-color);
        }
        
        .file-upload-icon {
            font-size: 40px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .file-upload-text {
            margin-bottom: 10px;
        }
        
        .file-upload-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .file-upload-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .uploaded-file {
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: var(--border-radius);
            margin-top: 15px;
        }
        
        .uploaded-file-icon {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .uploaded-file-info {
            flex: 1;
        }
        
        .uploaded-file-name {
            font-weight: 500;
            margin-bottom: 3px;
        }
        
        .uploaded-file-size {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .uploaded-file-remove {
            color: var(--text-color);
            cursor: pointer;
        }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* History Sidebar */
        .history-sidebar {
            position: fixed;
            top: 0;
            right: var(--navbar-width);
            width: 300px;
            height: 100vh;
            background-color: var(--dark-color);
            box-shadow: var(--shadow);
            transform: translateX(100%);
            transition: var(--transition);
            z-index: 9;
            padding: 20px;
            overflow-y: auto;
        }
        
        .history-sidebar.active {
            transform: translateX(0);
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .history-title {
            font-size: 18px;
            color: var(--primary-color);
        }
        
        .close-history {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .history-item {
            padding: 12px;
            margin-bottom: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .history-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .history-item.active {
            background-color: var(--primary-color);
        }
        
        /* Settings Sidebar */
        .settings-sidebar {
            position: fixed;
            top: 0;
            right: var(--navbar-width);
            width: 300px;
            height: 100vh;
            background-color: var(--dark-color);
            box-shadow: var(--shadow);
            transform: translateX(100%);
            transition: var(--transition);
            z-index: 9;
            padding: 20px;
            overflow-y: auto;
        }
        
        .settings-sidebar.active {
            transform: translateX(0);
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .settings-title {
            font-size: 18px;
            color: var(--primary-color);
        }
        
        .close-settings {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .settings-group {
            margin-bottom: 25px;
        }
        
        .settings-group-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .settings-label {
            font-size: 14px;
        }
        
        .settings-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Light Theme */
        body.light-theme {
            --dark-color: #f5f5f5;
            --light-color: #ffffff;
            --text-color: #333333;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-color: #eaeaea;
        }
        
        body.light-theme .ai-message {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        body.light-theme .input-area,
        body.light-theme .chat-messages,
        body.light-theme .header {
            background-color: var(--light-color);
        }
        
        body.light-theme .right-navbar,
        body.light-theme .history-sidebar,
        body.light-theme .settings-sidebar {
            background-color: #e0e0e0;
        }
        
        body.light-theme .nav-item {
            background-color: rgba(0, 0, 0, 0.1);
            color: #333;
        }
        
        body.light-theme .nav-item:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        body.light-theme .nav-item .tooltip {
            background-color: #333;
            color: white;
        }
        
        body.light-theme .history-item,
        body.light-theme .settings-option {
            background-color: rgba(0, 0, 0, 0.05);
            color: #333;
        }
        
        body.light-theme .history-item:hover,
        body.light-theme .settings-option:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .right-navbar {
                width: 100%;
                bottom: 0;
                top: auto;
                height: auto;
                flex-direction: row;
                justify-content: space-around;
                padding: 10px 0;
            }
            
            .main-content {
                margin-right: 0;
                margin-bottom: 70px;
            }
            
            .header-title span {
                display: none;
            }
            
            .header-title i {
                font-size: 24px;
            }
            
            .history-sidebar,
            .settings-sidebar {
                width: 100%;
                right: 0;
            }
            
            .nav-item {
                margin: 0 5px;
            }
            
            .nav-item .tooltip {
                bottom: 60px;
                right: auto;
                left: 50%;
                transform: translateX(-50%);
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .right-navbar {
                width: 60px;
            }
            
            .nav-item {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .main-content {
                margin-right: 60px;
            }
            
            .history-sidebar,
            .settings-sidebar {
                width: 250px;
            }
        }
        
        @media (min-width: 1025px) and (max-width: 1920px) {
            /* Normal desktop styles */
        }
        
        @media (min-width: 1921px) {
            .right-navbar {
                width: 100px;
            }
            
            .nav-item {
                width: 70px;
                height: 70px;
                font-size: 28px;
                margin: 20px 0;
            }
            
            .main-content {
                margin-right: 100px;
                max-width: 1600px;
            }
            
            .history-sidebar,
            .settings-sidebar {
                width: 350px;
            }
            
            .header-title {
                font-size: 28px;
            }
            
            .header-btn {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
            
            #user-input {
                font-size: 20px;
                min-height: 70px;
            }
            
            #send-button {
                width: 70px;
                height: 70px;
                font-size: 24px;
            }
            
            .message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body class="dark-theme">
    <!-- Ana İçerik -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <i class="fas fa-apple-alt"></i>
                <span>Domates AI Hacılar Pro Max</span>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="header-btn" id="new-chat-btn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </header>

        <!-- Chat Container -->
        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <div class="welcome-animation">
                    <div class="tomato-icon">
                        <i class="fas fa-apple-alt"></i>
                    </div>
                    <h2>Domates AI Hacılar Pro Max</h2>
                    <p>Matematik çözer, hikaye yazar, resim analiz ederim! Ne istersen sor hacı!</p>
                </div>
                
                <div class="message ai-message">
                    Selam hacı! Ben Domates AI Hacılar'ın en gelişmiş sürümüyüm. Bana:
                    <br><br>
                    - Matematik problemleri çözdürebilirsin (100x100'e kadar)<br>
                    - Hikaye yazdırabilirsin<br>
                    - Resim yükleyip analiz ettirebilirsin<br>
                    - Ses kaydı gönderebilirsin<br>
                    - Dosya yükleyebilirsin<br>
                    <br>
                    Ne yapmamı istersin?
                    <span class="message-time">Şimdi</span>
                </div>
                
                <div class="typing-indicator" id="typing-indicator">
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                </div>
            </div>
            
            <div class="input-area">
                <div class="input-actions" id="input-actions">
                    <button class="input-action-btn" id="attach-image" title="Resim Ekle">
                        <i class="fas fa-image"></i>
                    </button>
                    <button class="input-action-btn" id="attach-file" title="Dosya Ekle">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="input-action-btn" id="record-audio" title="Ses Kaydı">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="input-action-btn" id="math-solver" title="Matematik Çözücü">
                        <i class="fas fa-square-root-alt"></i>
                    </button>
                    <button class="input-action-btn" id="story-writer" title="Hikaye Yaz">
                        <i class="fas fa-book"></i>
                    </button>
                </div>
                
                <textarea id="user-input" placeholder="Domates gibi bir soru yaz hacı..." rows="1" autofocus></textarea>
                <button id="send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Sağ Navbar -->
    <div class="right-navbar">
        <div class="nav-item" id="nav-home" title="Ana Sayfa">
            <i class="fas fa-home"></i>
            <span class="tooltip">Ana Sayfa</span>
        </div>
        <div class="nav-item" id="nav-history" title="Sohbet Geçmişi">
            <i class="fas fa-history"></i>
            <span class="tooltip">Geçmiş</span>
        </div>
        <div class="nav-item" id="nav-settings" title="Ayarlar">
            <i class="fas fa-cog"></i>
            <span class="tooltip">Ayarlar</span>
        </div>
        <div class="nav-item" id="nav-image" title="Resim Analiz">
            <i class="fas fa-camera"></i>
            <span class="tooltip">Resim Analiz</span>
        </div>
        <div class="nav-item" id="nav-math" title="Matematik Çözücü">
            <i class="fas fa-calculator"></i>
            <span class="tooltip">Matematik</span>
        </div>
        <div class="nav-item" id="nav-story" title="Hikaye Yaz">
            <i class="fas fa-book-open"></i>
            <span class="tooltip">Hikaye Yaz</span>
        </div>
        <div class="nav-item" id="nav-voice" title="Sesli Asistan">
            <i class="fas fa-microphone-alt"></i>
            <span class="tooltip">Sesli Asistan</span>
        </div>
    </div>

    <!-- Sohbet Geçmişi Sidebar -->
    <div class="history-sidebar" id="history-sidebar">
        <div class="history-header">
            <h3 class="history-title">Sohbet Geçmişi</h3>
            <button class="close-history" id="close-history">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="history-list">
            <!-- Geçmiş sohbetler buraya eklenecek -->
        </div>
    </div>

    <!-- Ayarlar Sidebar -->
    <div class="settings-sidebar" id="settings-sidebar">
        <div class="settings-header">
            <h3 class="settings-title"><i class="fas fa-cog"></i> Ayarlar</h3>
            <button class="close-settings" id="close-settings">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-group-title"><i class="fas fa-paint-brush"></i> Görünüm</h4>
            
            <div class="settings-option">
                <span class="settings-label">Koyu Tema</span>
                <div class="settings-control">
                    <label class="switch">
                        <input type="checkbox" id="dark-mode-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-option">
                <span class="settings-label">Animasyonlar</span>
                <div class="settings-control">
                    <label class="switch">
                        <input type="checkbox" id="animations-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-group-title"><i class="fas fa-bell"></i> Bildirimler</h4>
            
            <div class="settings-option">
                <span class="settings-label">Ses Efektleri</span>
                <div class="settings-control">
                    <label class="switch">
                        <input type="checkbox" id="sound-effects-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-group-title"><i class="fas fa-robot"></i> AI Ayarları</h4>
            
            <div class="settings-option">
                <span class="settings-label">Yaratıcılık Seviyesi</span>
                <div class="settings-control">
                    <select id="creativity-level" class="form-control">
                        <option value="low">Düşük</option>
                        <option value="medium" selected>Orta</option>
                        <option value="high">Yüksek</option>
                    </select>
                </div>
            </div>
            
            <div class="settings-option">
                <span class="settings-label">Yanıt Uzunluğu</span>
                <div class="settings-control">
                    <select id="response-length" class="form-control">
                        <option value="short">Kısa</option>
                        <option value="medium" selected>Orta</option>
                        <option value="long">Uzun</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-group-title"><i class="fas fa-database"></i> Veri Yönetimi</h4>
            
            <button class="btn btn-secondary" id="clear-history" style="width: 100%; margin-bottom: 10px;">
                <i class="fas fa-trash"></i> Geçmişi Temizle
            </button>
            
            <button class="btn btn-secondary" id="export-data" style="width: 100%; margin-bottom: 10px;">
                <i class="fas fa-file-export"></i> Verileri Dışa Aktar
            </button>
            
            <button class="btn btn-secondary" id="import-data" style="width: 100%;">
                <i class="fas fa-file-import"></i> Verileri İçe Aktar
            </button>
        </div>
    </div>

    <!-- Resim Yükleme Modal -->
    <div class="modal" id="image-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-image"></i> Resim Yükle</h3>
                <button class="close-modal" id="close-image-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="file-upload-container" id="image-upload-area">
                    <div class="file-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="file-upload-text">
                        Resmi sürükleyip bırakın veya tıklayarak seçin
                    </div>
                    <button class="file-upload-btn" id="select-image-btn">Resim Seç</button>
                    <input type="file" id="image-input" accept="image/*" style="display: none;">
                </div>
                <div id="uploaded-image-container" style="display: none;">
                    <div class="uploaded-file">
                        <div class="uploaded-file-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="uploaded-file-info">
                            <div class="uploaded-file-name" id="image-file-name">resim.jpg</div>
                            <div class="uploaded-file-size" id="image-file-size">2.4 MB</div>
                        </div>
                        <div class="uploaded-file-remove" id="remove-image">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                    <div id="image-preview" style="margin-top: 15px; text-align: center;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-image">İptal</button>
                <button class="btn btn-primary" id="send-image">Gönder</button>
            </div>
        </div>
    </div>

    <!-- Dosya Yükleme Modal -->
    <div class="modal" id="file-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-file"></i> Dosya Yükle</h3>
                <button class="close-modal" id="close-file-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="file-upload-container" id="file-upload-area">
                    <div class="file-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="file-upload-text">
                        Dosyayı sürükleyip bırakın veya tıklayarak seçin
                    </div>
                    <button class="file-upload-btn" id="select-file-btn">Dosya Seç</button>
                    <input type="file" id="file-input" style="display: none;">
                </div>
                <div id="uploaded-file-container" style="display: none;">
                    <div class="uploaded-file">
                        <div class="uploaded-file-icon">
                            <i class="fas fa-file"></i>
                        </div>
                        <div class="uploaded-file-info">
                            <div class="uploaded-file-name" id="file-file-name">dosya.pdf</div>
                            <div class="uploaded-file-size" id="file-file-size">2.4 MB</div>
                        </div>
                        <div class="uploaded-file-remove" id="remove-file">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-file">İptal</button>
                <button class="btn btn-primary" id="send-file">Gönder</button>
            </div>
        </div>
    </div>

    <!-- Matematik Çözücü Modal -->
    <div class="modal" id="math-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-square-root-alt"></i> Matematik Çözücü</h3>
                <button class="close-modal" id="close-math-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="math-problem">Matematik Problemi (100x100'e kadar işlemler)</label>
                    <textarea id="math-problem" class="form-control" rows="3" placeholder="Örneğin: 2x + 5 = 15 denklemini çöz"></textarea>
                </div>
                <div id="math-result" style="margin-top: 20px; display: none;">
                    <h4 style="margin-bottom: 10px;">Çözüm:</h4>
                    <div id="math-solution" style="background-color: rgba(255,255,255,0.1); padding: 15px; border-radius: var(--border-radius);"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-math">İptal</button>
                <button class="btn btn-primary" id="solve-math">Çöz</button>
            </div>
        </div>
    </div>

    <!-- Hikaye Yazıcı Modal -->
    <div class="modal" id="story-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-book-open"></i> Hikaye Yazıcı</h3>
                <button class="close-modal" id="close-story-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="story-prompt">Hikaye Konusu</label>
                    <textarea id="story-prompt" class="form-control" rows="3" placeholder="Örneğin: Mars'ta yaşayan bir domates çiftçisinin hikayesini yaz"></textarea>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label for="story-style">Hikaye Tarzı</label>
                    <select id="story-style" class="form-control">
                        <option value="masal">Masal</option>
                        <option value="bilim-kurgu">Bilim Kurgu</option>
                        <option value="gerilim">Gerilim</option>
                        <option value="komedi">Komedi</option>
                        <option value="romantik">Romantik</option>
                        <option value="macera">Macera</option>
                        <option value="korku">Korku</option>
                        <option value="fantastik">Fantastik</option>
                    </select>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label for="story-length">Hikaye Uzunluğu</label>
                    <select id="story-length" class="form-control">
                        <option value="short">Kısa (1-2 paragraf)</option>
                        <option value="medium" selected>Orta (3-5 paragraf)</option>
                        <option value="long">Uzun (5+ paragraf)</option>
                    </select>
                </div>
                <div id="story-result" style="margin-top: 20px; display: none;">
                    <h4 style="margin-bottom: 10px;">Hikayeniz:</h4>
                    <div id="story-content" style="background-color: rgba(255,255,255,0.1); padding: 15px; border-radius: var(--border-radius); white-space: pre-line;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-story">İptal</button>
                <button class="btn btn-primary" id="generate-story">Oluştur</button>
            </div>
        </div>
    </div>

    <!-- Ses Kaydı Modal -->
    <div class="modal" id="voice-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-microphone"></i> Ses Kaydı</h3>
                <button class="close-modal" id="close-voice-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div id="voice-recording-icon" style="font-size: 40px; color: var(--primary-color); margin-bottom: 10px;">
                        <i class="fas fa-microphone"></i>
                    </div>
                    <div id="recording-status">Kayıt başlatılmadı</div>
                    <div id="recording-timer" style="font-size: 24px; margin: 10px 0;">00:00</div>
                </div>
                <div id="recorded-audio-container" style="display: none;">
                    <audio id="recorded-audio" controls style="width: 100%; margin-bottom: 15px;"></audio>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-voice">İptal</button>
                <button class="btn btn-primary" id="start-recording">Kaydı Başlat</button>
                <button class="btn btn-primary" id="send-voice" style="display: none;">Gönder</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');
            const chatMessages = document.getElementById('chat-messages');
            const typingIndicator = document.getElementById('typing-indicator');
            const inputActions = document.getElementById('input-actions');
            const themeToggle = document.getElementById('theme-toggle');
            const newChatBtn = document.getElementById('new-chat-btn');
            
            // Navbar items
            const navHome = document.getElementById('nav-home');
            const navHistory = document.getElementById('nav-history');
            const navSettings = document.getElementById('nav-settings');
            const navImage = document.getElementById('nav-image');
            const navMath = document.getElementById('nav-math');
            const navStory = document.getElementById('nav-story');
            const navVoice = document.getElementById('nav-voice');
            
            // History sidebar elements
            const historySidebar = document.getElementById('history-sidebar');
            const closeHistory = document.getElementById('close-history');
            const historyList = document.getElementById('history-list');
            
            // Settings sidebar elements
            const settingsSidebar = document.getElementById('settings-sidebar');
            const closeSettings = document.getElementById('close-settings');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const animationsToggle = document.getElementById('animations-toggle');
            const soundEffectsToggle = document.getElementById('sound-effects-toggle');
            const creativityLevel = document.getElementById('creativity-level');
            const responseLength = document.getElementById('response-length');
            const clearHistoryBtn = document.getElementById('clear-history');
            const exportDataBtn = document.getElementById('export-data');
            const importDataBtn = document.getElementById('import-data');
            
            // Image modal elements
            const imageModal = document.getElementById('image-modal');
            const closeImageModal = document.getElementById('close-image-modal');
            const imageUploadArea = document.getElementById('image-upload-area');
            const selectImageBtn = document.getElementById('select-image-btn');
            const imageInput = document.getElementById('image-input');
            const uploadedImageContainer = document.getElementById('uploaded-image-container');
            const imageFileName = document.getElementById('image-file-name');
            const imageFileSize = document.getElementById('image-file-size');
            const removeImage = document.getElementById('remove-image');
            const imagePreview = document.getElementById('image-preview');
            const cancelImage = document.getElementById('cancel-image');
            const sendImage = document.getElementById('send-image');
            
            // File modal elements
            const fileModal = document.getElementById('file-modal');
            const closeFileModal = document.getElementById('close-file-modal');
            const fileUploadArea = document.getElementById('file-upload-area');
            const selectFileBtn = document.getElementById('select-file-btn');
            const fileInput = document.getElementById('file-input');
            const uploadedFileContainer = document.getElementById('uploaded-file-container');
            const fileFileName = document.getElementById('file-file-name');
            const fileFileSize = document.getElementById('file-file-size');
            const removeFile = document.getElementById('remove-file');
            const cancelFile = document.getElementById('cancel-file');
            const sendFile = document.getElementById('send-file');
            
            // Math modal elements
            const mathModal = document.getElementById('math-modal');
            const closeMathModal = document.getElementById('close-math-modal');
            const mathProblem = document.getElementById('math-problem');
            const mathResult = document.getElementById('math-result');
            const mathSolution = document.getElementById('math-solution');
            const cancelMath = document.getElementById('cancel-math');
            const solveMath = document.getElementById('solve-math');
            
            // Story modal elements
            const storyModal = document.getElementById('story-modal');
            const closeStoryModal = document.getElementById('close-story-modal');
            const storyPrompt = document.getElementById('story-prompt');
            const storyStyle = document.getElementById('story-style');
            const storyLength = document.getElementById('story-length');
            const storyResult = document.getElementById('story-result');
            const storyContent = document.getElementById('story-content');
            const cancelStory = document.getElementById('cancel-story');
            const generateStory = document.getElementById('generate-story');
            
            // Voice modal elements
            const voiceModal = document.getElementById('voice-modal');
            const closeVoiceModal = document.getElementById('close-voice-modal');
            const recordingStatus = document.getElementById('recording-status');
            const recordingTimer = document.getElementById('recording-timer');
            const recordedAudioContainer = document.getElementById('recorded-audio-container');
            const recordedAudio = document.getElementById('recorded-audio');
            const cancelVoice = document.getElementById('cancel-voice');
            const startRecording = document.getElementById('start-recording');
            const sendVoice = document.getElementById('send-voice');
            
            // State
            let recordedChunks = [];
            let mediaRecorder;
            let recordingStartTime;
            let recordingTimerInterval;
            let currentChatId = generateChatId();
            let chats = JSON.parse(localStorage.getItem('domatesAI_chats')) || {};
            let settings = JSON.parse(localStorage.getItem('domatesAI_settings')) || {
                darkMode: true,
                animations: true,
                soundEffects: false,
                creativityLevel: 'medium',
                responseLength: 'medium'
            };
            
            // Initialize
            initializeEventListeners();
            loadSettings();
            loadChatHistory();
            loadChat(currentChatId);
            
            function initializeEventListeners() {
                // Input area events
                sendButton.addEventListener('click', handleUserInput);
                
                userInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        handleUserInput();
                    }
                });
                
                userInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
                
                userInput.addEventListener('focus', function() {
                    inputActions.classList.add('active');
                });
                
                userInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        inputActions.classList.remove('active');
                    }, 200);
                });
                
                // Theme toggle
                themeToggle.addEventListener('click', toggleTheme);
                
                // New chat
                newChatBtn.addEventListener('click', startNewChat);
                
                // Navbar items
                navHome.addEventListener('click', function() {
                    startNewChat();
                });
                
                navHistory.addEventListener('click', function() {
                    historySidebar.classList.toggle('active');
                    settingsSidebar.classList.remove('active');
                });
                
                navSettings.addEventListener('click', function() {
                    settingsSidebar.classList.toggle('active');
                    historySidebar.classList.remove('active');
                });
                
                navImage.addEventListener('click', function() {
                    imageModal.classList.add('active');
                });
                
                navMath.addEventListener('click', function() {
                    mathModal.classList.add('active');
                    mathProblem.focus();
                });
                
                navStory.addEventListener('click', function() {
                    storyModal.classList.add('active');
                    storyPrompt.focus();
                });
                
                navVoice.addEventListener('click', function() {
                    voiceModal.classList.add('active');
                });
                
                // History sidebar events
                closeHistory.addEventListener('click', function() {
                    historySidebar.classList.remove('active');
                });
                
                // Settings sidebar events
                closeSettings.addEventListener('click', function() {
                    settingsSidebar.classList.remove('active');
                });
                
                darkModeToggle.addEventListener('change', function() {
                    settings.darkMode = this.checked;
                    saveSettings();
                    applyTheme();
                });
                
                animationsToggle.addEventListener('change', function() {
                    settings.animations = this.checked;
                    saveSettings();
                });
                
                soundEffectsToggle.addEventListener('change', function() {
                    settings.soundEffects = this.checked;
                    saveSettings();
                });
                
                creativityLevel.addEventListener('change', function() {
                    settings.creativityLevel = this.value;
                    saveSettings();
                });
                
                responseLength.addEventListener('change', function() {
                    settings.responseLength = this.value;
                    saveSettings();
                });
                
                clearHistoryBtn.addEventListener('click', function() {
                    if (confirm('Tüm sohbet geçmişini silmek istediğinize emin misiniz? Bu işlem geri alınamaz!')) {
                        chats = {};
                        localStorage.removeItem('domatesAI_chats');
                        currentChatId = generateChatId();
                        loadChat(currentChatId);
                    }
                });
                
                exportDataBtn.addEventListener('click', function() {
                    const data = {
                        chats: chats,
                        settings: settings
                    };
                    const dataStr = JSON.stringify(data);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = 'domatesAI_backup.json';
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                });
                
                importDataBtn.addEventListener('click', function() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    
                    input.onchange = e => {
                        const file = e.target.files[0];
                        const reader = new FileReader();
                        reader.readAsText(file,'UTF-8');
                        
                        reader.onload = readerEvent => {
                            const content = readerEvent.target.result;
                            try {
                                const data = JSON.parse(content);
                                
                                if (data.chats && data.settings) {
                                    if (confirm('Mevcut verilerin üzerine yazılacak, emin misiniz?')) {
                                        chats = data.chats;
                                        settings = data.settings;
                                        
                                        localStorage.setItem('domatesAI_chats', JSON.stringify(chats));
                                        localStorage.setItem('domatesAI_settings', JSON.stringify(settings));
                                        
                                        loadSettings();
                                        loadChatHistory();
                                        loadChat(currentChatId);
                                        
                                        alert('Veriler başarıyla içe aktarıldı!');
                                    }
                                } else {
                                    alert('Geçersiz veri formatı!');
                                }
                            } catch (e) {
                                alert('Dosya okunurken hata oluştu: ' + e.message);
                            }
                        };
                    };
                    
                    input.click();
                });
                
                // Input action buttons
                document.getElementById('attach-image').addEventListener('click', function() {
                    imageModal.classList.add('active');
                });
                
                document.getElementById('attach-file').addEventListener('click', function() {
                    fileModal.classList.add('active');
                });
                
                document.getElementById('record-audio').addEventListener('click', function() {
                    voiceModal.classList.add('active');
                });
                
                document.getElementById('math-solver').addEventListener('click', function() {
                    mathModal.classList.add('active');
                    mathProblem.focus();
                });
                
                document.getElementById('story-writer').addEventListener('click', function() {
                    storyModal.classList.add('active');
                    storyPrompt.focus();
                });
                
                // Image modal events
                closeImageModal.addEventListener('click', function() {
                    imageModal.classList.remove('active');
                    resetImageUpload();
                });
                
                selectImageBtn.addEventListener('click', function() {
                    imageInput.click();
                });
                
                imageUploadArea.addEventListener('click', function() {
                    imageInput.click();
                });
                
                imageInput.addEventListener('change', handleImageUpload);
                
                removeImage.addEventListener('click', function(e) {
                    e.stopPropagation();
                    resetImageUpload();
                });
                
                cancelImage.addEventListener('click', function() {
                    imageModal.classList.remove('active');
                    resetImageUpload();
                });
                
                sendImage.addEventListener('click', function() {
                    if (imageInput.files.length > 0) {
                        const file = imageInput.files[0];
                        addMessage(`[Resim gönderildi: ${file.name}]`, true);
                        
                        // Create a preview of the image in chat
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const imgPreview = document.createElement('div');
                            imgPreview.style.marginTop = '10px';
                            imgPreview.style.textAlign = 'center';
                            imgPreview.innerHTML = `
                                <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: var(--border-radius);">
                            `;
                            
                            // Add the preview to the chat
                            const lastMessage = chatMessages.querySelector('.message:last-child');
                            if (lastMessage) {
                                lastMessage.appendChild(imgPreview);
                            }
                        };
                        reader.readAsDataURL(file);
                        
                        // Simulate AI response
                        setTimeout(() => {
                            simulateTyping().then(() => {
                                const responses = [
                                    "Hacı, bu resimde gördüğüm kadarıyla domatese benzer bir şey var!",
                                    "Vay hacı, bu resimdeki detayları analiz ediyorum...",
                                    "Resimdeki objeleri tanımlıyorum, biraz sabret hacı!",
                                    "Bu resimde domates yetiştirmek için harika bir bahçe var gibi görünüyor!",
                                    "Resim analiz sonuçları: %78 domates, %12 biber, %10 diğer :)",
                                    "Bu resimdeki renkler domatesin olgunluğunu anlatıyor gibi!",
                                    "Resimdeki kompozisyon gerçekten etkileyici hacı!",
                                    "Bu görseldeki detaylar domatesin tarihini anlatıyor sanki!",
                                    "Hacı, bu resimdeki ışık kullanımı domatesleri çok güzel aydınlatmış!",
                                    "Bu fotoğraf domatesin doğal güzelliğini çok iyi yansıtıyor!"
                                ];
                                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                                addMessage(randomResponse, false);
                            });
                        }, 1000);
                        
                        imageModal.classList.remove('active');
                        resetImageUpload();
                    } else {
                        alert("Lütfen önce bir resim seçin hacı!");
                    }
                });

                // File modal events
                closeFileModal.addEventListener('click', function() {
                    fileModal.classList.remove('active');
                    resetFileUpload();
                });
                
                selectFileBtn.addEventListener('click', function() {
                    fileInput.click();
                });
                
                fileUploadArea.addEventListener('click', function() {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', handleFileUpload);
                
                removeFile.addEventListener('click', function(e) {
                    e.stopPropagation();
                    resetFileUpload();
                });
                
                cancelFile.addEventListener('click', function() {
                    fileModal.classList.remove('active');
                    resetFileUpload();
                });
                
                sendFile.addEventListener('click', function() {
                    if (fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        addMessage(`[Dosya gönderildi: ${file.name}]`, true);
                        
                        // Simulate AI response based on file type
                        setTimeout(() => {
                            simulateTyping().then(() => {
                                let response = "";
                                const fileType = file.name.split('.').pop().toLowerCase();
                                
                                if (['pdf', 'doc', 'docx'].includes(fileType)) {
                                    response = "Hacı, bu belgeyi analiz ediyorum! Domates yetiştiriciliği hakkında bir şeyler var gibi!";
                                } else if (['xls', 'xlsx'].includes(fileType)) {
                                    response = "Bu tabloda domates üretim istatistikleri var gibi görünüyor hacı!";
                                } else if (['ppt', 'pptx'].includes(fileType)) {
                                    response = "Bu sunumda domatesler hakkında bilgiler var mı acaba?";
                                } else if (['txt', 'rtf'].includes(fileType)) {
                                    response = "Bu metin dosyasını okuyorum hacı, domatesle ilgili ipuçları arıyorum!";
                                } else {
                                    response = "Bu dosya türünü inceliyorum hacı, domatesle bağlantılı bir şeyler bulabilir miyim acaba?";
                                }
                                
                                addMessage(response, false);
                            });
                        }, 1000);
                        
                        fileModal.classList.remove('active');
                        resetFileUpload();
                    } else {
                        alert("Lütfen önce bir dosya seçin hacı!");
                    }
                });

                // Math modal events
                closeMathModal.addEventListener('click', function() {
                    mathModal.classList.remove('active');
                    resetMathModal();
                });

                cancelMath.addEventListener('click', function() {
                    mathModal.classList.remove('active');
                    resetMathModal();
                });

                solveMath.addEventListener('click', function() {
                    const problem = mathProblem.value.trim();
                    if (problem) {
                        solveMathProblem(problem);
                    } else {
                        alert("Lütfen bir matematik problemi yazın hacı!");
                    }
                });

                // Story modal events
                closeStoryModal.addEventListener('click', function() {
                    storyModal.classList.remove('active');
                    resetStoryModal();
                });

                cancelStory.addEventListener('click', function() {
                    storyModal.classList.remove('active');
                    resetStoryModal();
                });

                generateStory.addEventListener('click', function() {
                    const prompt = storyPrompt.value.trim();
                    if (prompt) {
                        generateStoryContent(prompt, storyStyle.value, storyLength.value);
                    } else {
                        alert("Lütfen bir hikaye konusu yazın hacı!");
                    }
                });

                // Voice modal events
                closeVoiceModal.addEventListener('click', function() {
                    voiceModal.classList.remove('active');
                    resetVoiceModal();
                });

                cancelVoice.addEventListener('click', function() {
                    voiceModal.classList.remove('active');
                    resetVoiceModal();
                });

                startRecording.addEventListener('click', startAudioRecording);

                sendVoice.addEventListener('click', function() {
                    if (recordedChunks.length > 0) {
                        addMessage("[Ses mesajı gönderildi]", true);
                        
                        // Simulate AI response
                        setTimeout(() => {
                            simulateTyping().then(() => {
                                const responses = [
                                    "Hacı, ses mesajını dinledim! Domates yetiştirmekten bahsetmişsin gibi geldi bana!",
                                    "Vay hacı, bu ses mesajındaki duyguyu analiz ediyorum...",
                                    "Sesinden anladığım kadarıyla domateslerin çok güzel yetişmiş!",
                                    "Ses mesajını işliyorum hacı, biraz sabret!",
                                    "Ses analiz sonuçları: %78 domates sevgisi, %12 bahçe heyecanı, %10 diğer :)",
                                    "Hacı, ses tonundan domateslerin çok güzel olduğunu anladım!",
                                    "Bu ses mesajındaki enerji domateslerin tazeliğini yansıtıyor!",
                                    "Sesinden domates hasadının iyi geçtiğini anladım hacı!",
                                    "Bu ses kaydındaki bilgiler domates tarımı için çok değerli!",
                                    "Hacı, ses mesajını dinledim ve domatesler hakkında harika fikirlerim var!"
                                ];
                                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                                addMessage(randomResponse, false);
                            });
                        }, 1000);
                        
                        voiceModal.classList.remove('active');
                        resetVoiceModal();
                    }
                });
            }

            function loadSettings() {
                darkModeToggle.checked = settings.darkMode;
                animationsToggle.checked = settings.animations;
                soundEffectsToggle.checked = settings.soundEffects;
                creativityLevel.value = settings.creativityLevel;
                responseLength.value = settings.responseLength;
                
                applyTheme();
            }

            function saveSettings() {
                localStorage.setItem('domatesAI_settings', JSON.stringify(settings));
            }

            function applyTheme() {
                if (settings.darkMode) {
                    document.body.classList.remove('light-theme');
                    document.body.classList.add('dark-theme');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                } else {
                    document.body.classList.remove('dark-theme');
                    document.body.classList.add('light-theme');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
            }

            function toggleTheme() {
                settings.darkMode = !settings.darkMode;
                saveSettings();
                applyTheme();
                
                // Add transition effect
                document.body.style.transition = 'background-color 0.5s ease, color 0.5s ease';
                setTimeout(() => {
                    document.body.style.transition = '';
                }, 500);
            }

            function generateChatId() {
                return 'chat-' + Date.now();
            }

            function loadChatHistory() {
                historyList.innerHTML = '';
                
                if (Object.keys(chats).length === 0) {
                    historyList.innerHTML = '<p style="text-align: center; opacity: 0.7;">Henüz sohbet geçmişi yok</p>';
                    return;
                }
                
                // Sort chats by timestamp (newest first)
                const sortedChatIds = Object.keys(chats).sort((a, b) => chats[b].timestamp - chats[a].timestamp);
                
                sortedChatIds.forEach(chatId => {
                    const chat = chats[chatId];
                    const firstMessage = chat.messages.find(msg => msg.isUser)?.content || 'Yeni Sohbet';
                    
                    const historyItem = document.createElement('div');
                    historyItem.classList.add('history-item');
                    historyItem.textContent = firstMessage.length > 50 ? firstMessage.substring(0, 50) + '...' : firstMessage;
                    historyItem.addEventListener('click', () => {
                        loadChat(chatId);
                        historySidebar.classList.remove('active');
                    });
                    
                    if (chatId === currentChatId) {
                        historyItem.classList.add('active');
                    }
                    
                    historyList.appendChild(historyItem);
                });
            }

            function loadChat(chatId) {
                currentChatId = chatId;
                
                // Clear chat messages except the welcome message
                const messagesToKeep = Array.from(chatMessages.querySelectorAll('.message')).slice(0, 1);
                Array.from(chatMessages.querySelectorAll('.message')).forEach(msg => {
                    if (!messagesToKeep.includes(msg)) {
                        msg.remove();
                    }
                });
                
                // Load chat messages if exists
                if (chats[chatId]) {
                    chats[chatId].messages.forEach(msg => {
                        addMessage(msg.content, msg.isUser);
                    });
                } else {
                    // Add default AI message for new chats
                    addMessage('Yeni sohbet başlatıldı hacı! Ne yapmamı istersin?', false);
                }
                
                // Update history sidebar
                loadChatHistory();
            }

            function saveChat() {
                const messages = Array.from(chatMessages.querySelectorAll('.message')).slice(1); // Skip welcome message
                
                chats[currentChatId] = {
                    id: currentChatId,
                    timestamp: Date.now(),
                    messages: messages.map(msg => ({
                        content: msg.textContent.trim(),
                        isUser: msg.classList.contains('user-message'),
                        timestamp: Date.now()
                    }))
                };
                
                localStorage.setItem('domatesAI_chats', JSON.stringify(chats));
                loadChatHistory();
            }

            function startNewChat() {
                currentChatId = generateChatId();
                loadChat(currentChatId);
            }

            function getCurrentTime() {
                const now = new Date();
                return now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            }

            function addMessage(message, isUser) {
                if (!message.trim()) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(isUser ? 'user-message' : 'ai-message');
                
                messageDiv.innerHTML = `
                    ${isUser ? `
                        <div class="message-actions">
                            <button class="message-action-btn" title="Düzenle">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="message-action-btn" title="Sil">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    ` : ''}
                    ${message}
                    <span class="message-time">${getCurrentTime()}</span>
                `;
                
                chatMessages.insertBefore(messageDiv, typingIndicator);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Save chat after adding message
                saveChat();
            }

            function simulateTyping() {
                if (!settings.animations) {
                    return Promise.resolve();
                }
                
                typingIndicator.style.display = 'block';
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                return new Promise(resolve => {
                    setTimeout(() => {
                        typingIndicator.style.display = 'none';
                        resolve();
                    }, 1500 + Math.random() * 2000);
                });
            }

            async function handleUserInput() {
                const message = userInput.value.trim();
                if (message === '') return;
                
                addMessage(message, true);
                userInput.value = '';
                userInput.style.height = 'auto';
                
                await simulateTyping();
                
                let response;
                
                if (message.toLowerCase().includes('matematik') || message.includes('+') || message.includes('-') || message.includes('*') || message.includes('/') || message.includes('x') || message.includes('=')) {
                    response = solveMathProblem(message, false);
                } else if (message.toLowerCase().includes('hikaye') || message.toLowerCase().includes('yaz') || message.toLowerCase().includes('anlat')) {
                    response = generateStoryContent(message, 'masal', 'medium', false);
                } else {
                    // Gelişmiş yapay zeka yanıtları
                    const knowledgeBase = {
                        'merhaba': ["Selam hacı! Domates gibi taze soruların varsa sormaktan çekinme!", "Merhaba dostum! Domates yetiştirmekle ilgili soruların mı var?", "Selam hacı! Domates AI Hacılar Pro Max hizmetinde!"],
                        'nasılsın': ["Ben domates gibi kırmızı ve enerjikim hacı! Sen nasılsın?", "Yapay zeka olduğum için her zaman formundayım hacı! Domateslerin nasıl?", "Ben iyiyim hacı! Senin domateslerin nasıl, iyi mi?"],
                        'teşekkür': ["Rica ederim hacı! Domates gibi lezzetli sorularını bekliyorum!", "Bir şey değil hacı! Domates yetiştirmekle ilgili başka sorun var mı?", "Ne demek hacı! Domates kadar tatlı soruların varsa beklerim!"],
                        'domates nasıl yetiştirilir': [
                            "Domates yetiştirmek için şu adımları izle hacı:\n1. Kaliteli domates tohumu seç\n2. İyi drene olan toprak hazırla\n3. Güneş alan bir yer seç\n4. Düzenli sulama yap\n5. Uygun gübreleme yap\n6. Hastalıklara karşı önlem al\n\nDomateslerin bol ve lezzetli olması için bu adımları takip et!",
                            "Domates yetiştirme rehberi:\n- Toprak sıcaklığı 15°C üstünde olmalı\n- Fideleri 50-60 cm aralıklarla dik\n- Haftada 2-3 kez sulama yap\n- Organik gübre kullan\n- Budama yaparak verimi artır\n\nBu ipuçlarıyla domateslerin çok güzel olacak hacı!"
                        ],
                        'en iyi domates çeşitleri': [
                            "İşte en iyi domates çeşitleri hacı:\n1. Salkım domates - Bol verimli\n2. Beef domates - İri ve etli\n3. Cherry domates - Küçük ve tatlı\n4. Roma domates - Salça için ideal\n5. Yeşil domates - Turşuluk\n\nHangisini yetiştireceğine karar ver hacı!",
                            "Favori domates çeşitlerim:\n- Pembe domates (geleneksel lezzet)\n- Sarı domates (tatlı ve az asitli)\n- Mor domates (antioksidan deposu)\n- Çeri domates (atıştırmalık)\n- Ağaç domates (uzun ömürlü)\n\nHangisini denemek istersin hacı?"
                        ],
                        'domates hastalıkları': [
                            "Domateslerde sık görülen hastalıklar:\n1. Mildiyö - Yapraklarda sarı lekeler\n2. Küllenme - Yapraklarda beyaz toz\n3. Çökerten - Fidelerin aniden ölmesi\n4. Solgunluk - Mantar kaynaklı\n\nÖnlem için:\n- Hastalıklı bitkileri uzaklaştır\n- Uygun ilaçlama yap\n- Toprak drenajını iyileştir",
                            "Domates hastalıkları ve çözümleri:\n- Yaprak kıvırcıklığı: Virüs kaynaklı, taşıyıcı böceklerle mücadele\n- Antraknoz: Meyvede çökük lekeler, mantar ilacı kullan\n- Bakteriyel benek: Yapraklarda küçük lekeler, bakır içerikli ilaç kullan\n\nErken teşhis çok önemli hacı!"
                        ]
                    };
                    
                    // Check for exact matches first
                    let foundResponse = false;
                    for (const [keyword, responses] of Object.entries(knowledgeBase)) {
                        if (message.toLowerCase().includes(keyword)) {
                            response = responses[Math.floor(Math.random() * responses.length)];
                            foundResponse = true;
                            break;
                        }
                    }
                    
                    // If no exact match, generate creative response
                    if (!foundResponse) {
                        const creativeResponses = [
                            "Hacı, bu konuda sana şöyle diyeyim: Domates gibi kırmızı bir cevap istiyorsan, doğru yerdesin!",
                            "Valla hacı, bu soruya cevabım domates kadar net: Evet!",
                            "Hacıım, bu biraz karışık. Şöyle anlatayım: Domates salçası gibi koyu bir konu bu.",
                            "Ben de senin gibi düşünüyorum hacı! Domatesler gibi olgunlaşmış bir fikrin var.",
                            "Hacı, bu soruyu sormakla domates gibi isabet ettin!",
                            "Bak hacı, bu işin aslı astarı şu: Domates yetiştirir gibi sabırlı olmalısın.",
                            "Hacııım, bu soruya cevap vermek için domates çorbası içmiş olmam lazım!",
                            "Vay hacı, bu soru tam bir domates bombası gibi patladı!",
                            "Hacı, bu konu domates kadar sulu, detaylı konuşmamız lazım.",
                            "Hacıım, domatesin serada yetiştiği gibi, bu konu da özen ister!",
                            "Bu sorunun cevabı domatesin olgunluk derecesine bağlı hacı!",
                            "Hacı, bu konuyu domates yetiştirir gibi sabırla ele almalıyız!",
                            "Valla hacı, bu sorunun cevabı domatesin çeşidi gibi değişir!",
                            "Hacıım, bu soru domates kadar çeşitli yönleri olan bir konu!",
                            "Domatesin rengi gibi net bir cevap vereyim hacı!",
                            "Bu konu domatesin tadı gibi karmaşık hacı, detaylı konuşalım!",
                            "Hacı, bu soru domates fideleri gibi özen isteyen bir konu!",
                            "Vay hacı, bu soru domates serası gibi verimli bir konu!",
                            "Hacıım, bu konu domatesin yetişme süreci gibi sabır gerektirir!",
                            "Domatesin olgunlaşma süreci gibi bu konu da zaman ister hacı!"
                        ];
                        response = creativeResponses[Math.floor(Math.random() * creativeResponses.length)];
                    }
                }
                
                addMessage(response, false);
                
                // Random follow-up
                if (Math.random() > 0.7) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    await simulateTyping();
                    addMessage("Başka bir sorun var mı hacı? Domates gibi taze fikirlerim var!", false);
                }
            }

            function handleImageUpload(e) {
                const file = e.target.files[0];
                if (file) {
                    // Display file info
                    imageFileName.textContent = file.name;
                    imageFileSize.textContent = formatFileSize(file.size);
                    uploadedImageContainer.style.display = 'block';
                    
                    // Show preview if it's an image
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imagePreview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: var(--border-radius);">`;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        imagePreview.innerHTML = '';
                    }
                }
            }

            function handleFileUpload(e) {
                const file = e.target.files[0];
                if (file) {
                    // Display file info
                    fileFileName.textContent = file.name;
                    fileFileSize.textContent = formatFileSize(file.size);
                    uploadedFileContainer.style.display = 'block';
                }
            }

            function resetImageUpload() {
                imageInput.value = '';
                uploadedImageContainer.style.display = 'none';
                imagePreview.innerHTML = '';
            }

            function resetFileUpload() {
                fileInput.value = '';
                uploadedFileContainer.style.display = 'none';
            }

            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
            }

            function resetMathModal() {
                mathProblem.value = '';
                mathResult.style.display = 'none';
            }

            function solveMathProblem(problem, showInModal = true) {
                let solution;
                
                try {
                    // Basic math solutions
                    if (problem.includes('+')) {
                        const numbers = problem.split('+').map(num => parseFloat(num.trim()));
                        if (numbers.some(num => num > 100)) {
                            solution = "Hacı, 100'den büyük sayıları toplayamam! Domateslerim yetmez!";
                        } else {
                            const result = numbers.reduce((a, b) => a + b, 0);
                            solution = `Toplama sonucu: ${numbers.join(' + ')} = ${result}`;
                        }
                    } else if (problem.includes('-')) {
                        const numbers = problem.split('-').map(num => parseFloat(num.trim()));
                        if (numbers.some(num => num > 100)) {
                            solution = "Hacı, 100'den büyük sayıları çıkaramam! Domateslerim yetmez!";
                        } else {
                            const result = numbers.reduce((a, b) => a - b);
                            solution = `Çıkarma sonucu: ${numbers.join(' - ')} = ${result}`;
                        }
                    } else if (problem.includes('*') || problem.includes('x')) {
                        const numbers = problem.split(/[\*x]/).map(num => parseFloat(num.trim()));
                        if (numbers.some(num => num > 100)) {
                            solution = "Hacı, 100'den büyük sayıları çarpamam! Domateslerim patlar!";
                        } else {
                            const result = numbers.reduce((a, b) => a * b, 1);
                            solution = `Çarpma sonucu: ${numbers.join(' × ')} = ${result}`;
                        }
                    } else if (problem.includes('/')) {
                        const numbers = problem.split('/').map(num => parseFloat(num.trim()));
                        if (numbers.some(num => num > 100)) {
                            solution = "Hacı, 100'den büyük sayıları bölemem! Domateslerim yetmez!";
                        } else if (numbers[1] === 0) {
                            solution = "Hacı, sıfıra bölme yapamazsın! Domatesler bile bunu bilir!";
                        } else {
                            const result = numbers[0] / numbers[1];
                            solution = `Bölme sonucu: ${numbers[0]} ÷ ${numbers[1]} = ${result.toFixed(2)}`;
                        }
                    } else if (problem.toLowerCase().includes('karekök')) {
                        const number = parseFloat(problem.replace(/[^\d.]/g, ''));
                        if (number > 10000) {
                            solution = "Hacı, 10000'den büyük sayıların karekökünü alamam! Domateslerim yetmez!";
                        } else if (number >= 0) {
                            solution = `Karekök sonucu: √${number} = ${Math.sqrt(number).toFixed(2)}`;
                        } else {
                            solution = "Hacı, negatif sayıların karekökü olmaz! Domatesler bile reel sayıları sever!";
                        }
                    } else if (problem.includes('=') && problem.includes('x')) {
                        // Simple linear equation
                        const equationParts = problem.split('=');
                        const leftSide = equationParts[0].trim();
                        const rightSide = equationParts[1].trim();
                        
                        if (leftSide.includes('x')) {
                            const coefficient = parseFloat(leftSide.replace(/[^\d.-]/g, '')) || 1;
                            const constant = parseFloat(rightSide);
                            
                            if (coefficient > 100 || constant > 100) {
                                solution = "Hacı, 100'den büyük katsayıları işleyemem! Domateslerim yetmez!";
                            } else {
                                solution = "Denklem çözümü:\n";
                                solution += `1. Adım: ${leftSide} = ${rightSide}\n`;
                                solution += `2. Adım: ${coefficient}x = ${rightSide}\n`;
                                solution += `3. Adım: x = ${rightSide} / ${coefficient}\n`;
                                solution += `4. Adım: x = ${(constant / coefficient).toFixed(2)}\n`;
                                solution += `\nSonuç: x = ${(constant / coefficient).toFixed(2)}`;
                            }
                        }
                    } else {
                        solution = "Hacı, bu matematik problemini tam anlayamadım. Domates yetiştirmek daha kolay geliyor bana!";
                    }
                } catch (e) {
                    solution = "Hacı, bu işlemi yapamadım! Belki daha basit bir problem sorsan?";
                }
                
                if (showInModal) {
                    mathSolution.innerHTML = solution.replace(/\n/g, '<br>');
                    mathResult.style.display = 'block';
                }
                
                return solution;
            }

            function resetStoryModal() {
                storyPrompt.value = '';
                storyResult.style.display = 'none';
            }

            function generateStoryContent(prompt, style, length, showInModal = true) {
                const styleIntros = {
                    'masal': [
                        "Bir varmış bir yokmuş...",
                        "Evvel zaman içinde...",
                        "Çok eski zamanlarda..."
                    ],
                    'bilim-kurgu': [
                        "Yıl 2150, Mars kolonisinde...",
                        "Geleceğin dünyasında...",
                        "Uzay gemisinin köşesinde..."
                    ],
                    'gerilim': [
                        "Gece yarısı, eski evin tavan arasında tuhaf bir ses...",
                        "Karanlık koridorda tek başına yürürken...",
                        "Kapı çalındığında saat gece yarısını geçiyordu..."
                    ],
                    'komedi': [
                        "Bir gün, sakar bir domates çiftçisi...",
                        "Gülmekten kırıldığımız bir günde...",
                        "Komik bir olay zinciri başladığında..."
                    ],
                    'romantik': [
                        "Güneş batarken, iki domates fidanesi birbirine bakarak...",
                        "Aşk dolu bir bahar gününde...",
                        "Kalplerin birbirine yaklaştığı o an..."
                    ],
                    'macera': [
                        "Tehlikeli bir yolculuk başlarken...",
                        "Bilinmeyen diyarlara doğru yola çıktığımızda...",
                        "Hazine haritasını bulduğumuz gün..."
                    ],
                    'korku': [
                        "Karanlık basmıştı ve tek başınaydım...",
                        "Garip sesler duyduğum o gece...",
                        "Kapılar kendi kendine açılıyordu..."
                    ],
                    'fantastik': [
                        "Büyülü krallığın son kalesinde...",
                        "Ejderhaların özgürce uçtuğu diyarda...",
                        "Sihirli asayı elime aldığım an..."
                    ]
                };
                
                const styleOutros = {
                    'masal': "ve onlar ermiş muradına, biz çıkalım kerevetine!",
                    'bilim-kurgu': "ve böylece galaksinin kaderi değişti...",
                    'gerilim': "ve asla ne olduğunu tam olarak öğrenemedik...",
                    'komedi': "ve böylece gülmekten yerlere yattık!",
                    'romantik': "ve aşkları domatesler gibi kırmızı ve tatlı kaldı...",
                    'macera': "ve macera dolu yolculuk devam etti...",
                    'korku': "ve o geceden sonra hiçbir şey eskisi gibi olmadı...",
                    'fantastik': "ve büyülü diyarlarda maceraları devam etti..."
                };
                
                const lengthSettings = {
                    'short': {
                        paragraphs: 1,
                        sentences: 3
                    },
                    'medium': {
                        paragraphs: 3,
                        sentences: 5
                    },
                    'long': {
                        paragraphs: 5,
                        sentences: 8
                    }
                };
                
                const selectedStyle = styleIntros[style] || styleIntros['masal'];
                const styleIntro = selectedStyle[Math.floor(Math.random() * selectedStyle.length)];
                const styleOutro = styleOutros[style] || styleOutros['masal'];
                const lengthConfig = lengthSettings[length] || lengthSettings['medium'];
                
                let story = `${styleIntro}\n\n${prompt}\n\n`;
                
                // Generate story based on creativity level
                const creativity = settings.creativityLevel;
                const creativityFactors = {
                    'low': { twists: 0, details: 1, characters: 1 },
                    'medium': { twists: 1, details: 2, characters: 2 },
                    'high': { twists: 2, details: 3, characters: 3 }
                };
                
                const factors = creativityFactors[creativity];
                
                // Generate paragraphs
                for (let p = 0; p < lengthConfig.paragraphs; p++) {
                    let paragraph = "";
                    
                    // Generate sentences
                    for (let s = 0; s < lengthConfig.sentences; s++) {
                        let sentence = "";
                        
                        // Add some variety based on creativity
                        if (s === 0 && p === 0) {
                            sentence = `"${prompt}" diye başladı hikaye. `;
                        } else {
                            const sentenceTypes = [
                                `Domatesler ${['şarkı söylüyordu', 'gizemli bir şekilde parlıyordu', 'sessizce büyüyordu'][Math.floor(Math.random() * 3)]}. `,
                                `Bir ${['çiftçi', 'şövalye', 'bilim insanı', 'cadı'][Math.floor(Math.random() * 4)]} ortaya çıktı. `,
                                `Aniden ${['gök gürledi', 'her şey değişti', 'sıradışı bir olay oldu'][Math.floor(Math.random() * 3)]}. `,
                                `Bu sırada ${['uzaklarda', 'komşu köyde', 'eski bir şatoda'][Math.floor(Math.random() * 3)]}... `,
                                `Hiç kimse ${['bu kadar hızlı', 'bu kadar gizemli', 'bu kadar beklenmedik'][Math.floor(Math.random() * 3)]} olacağını tahmin edemezdi. `
                            ];
                            
                            sentence = sentenceTypes[Math.floor(Math.random() * sentenceTypes.length)];
                            
                            // Add twists for higher creativity
                            if (factors.twists > 0 && Math.random() > 0.7) {
                                const twists = [
                                    `Ama hiç kimsenin bilmediği bir sır vardı... `,
                                    `Ancak işler göründüğü gibi değildi... `,
                                    `Fakat beklenmedik bir gelişme oldu... `
                                ];
                                sentence = twists[Math.floor(Math.random() * twists.length)] + sentence;
                            }
                            
                            // Add details for higher creativity
                            if (factors.details > 0 && Math.random() > 0.5) {
                                const details = [
                                    `Hava ${['ağır', 'tatlı', 'gizemli'][Math.floor(Math.random() * 3)]} bir kokuydu. `,
                                    `Etrafta ${['eski', 'tozlu', 'büyülü'][Math.floor(Math.random() * 3)]} eşyalar vardı. `,
                                    `Her şey ${['kırmızı', 'altın', 'gümüş'][Math.floor(Math.random() * 3)]} bir ışıkla aydınlanmıştı. `
                                ];
                                sentence += details[Math.floor(Math.random() * details.length)];
                            }
                        }
                        
                        paragraph += sentence;
                    }
                    
                    story += paragraph + "\n\n";
                }
                
                story += styleOutro;
                
                if (showInModal) {
                    storyContent.textContent = story;
                    storyResult.style.display = 'block';
                }
                
                return story;
            }

            function resetVoiceModal() {
                recordedChunks = [];
                recordedAudio.src = '';
                recordedAudioContainer.style.display = 'none';
                recordingStatus.textContent = 'Kayıt başlatılmadı';
                recordingTimer.textContent = '00:00';
                startRecording.style.display = 'block';
                sendVoice.style.display = 'none';
                document.getElementById('voice-recording-icon').innerHTML = '<i class="fas fa-microphone"></i>';
                clearInterval(recordingTimerInterval);
            }

            function startAudioRecording() {
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.getUserMedia({ audio: true })
                        .then(stream => {
                            mediaRecorder = new MediaRecorder(stream);
                            recordedChunks = [];
                            
                            mediaRecorder.ondataavailable = function(e) {
                                if (e.data.size > 0) {
                                    recordedChunks.push(e.data);
                                }
                            };
                            
                            mediaRecorder.onstop = function() {
                                const audioBlob = new Blob(recordedChunks, { type: 'audio/wav' });
                                const audioUrl = URL.createObjectURL(audioBlob);
                                recordedAudio.src = audioUrl;
                                recordedAudioContainer.style.display = 'block';
                                startRecording.style.display = 'none';
                                sendVoice.style.display = 'block';
                                document.getElementById('voice-recording-icon').innerHTML = '<i class="fas fa-microphone"></i>';
                                recordingStatus.textContent = 'Kayıt tamamlandı';
                                clearInterval(recordingTimerInterval);
                            };
                            
                            mediaRecorder.start();
                            recordingStartTime = Date.now();
                            updateRecordingTimer();
                            recordingTimerInterval = setInterval(updateRecordingTimer, 1000);
                            
                            document.getElementById('voice-recording-icon').innerHTML = '<i class="fas fa-microphone" style="color: red;"></i>';
                            recordingStatus.textContent = 'Kayıt devam ediyor...';
                            startRecording.style.display = 'none';
                            sendVoice.style.display = 'block';
                            sendVoice.textContent = 'Kaydı Durdur';
                            sendVoice.onclick = stopAudioRecording;
                        })
                        .catch(err => {
                            console.error('Ses kaydı hatası:', err);
                            alert('Ses kaydı başlatılamadı. Mikrofon erişimine izin verdiğinizden emin olun.');
                        });
                } else {
                    alert('Tarayıcınız ses kaydını desteklemiyor hacı!');
                }
            }

            function stopAudioRecording() {
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                    sendVoice.textContent = 'Gönder';
                    sendVoice.onclick = function() {
                        document.getElementById('send-voice').click();
                    };
                }
            }

            function updateRecordingTimer() {
                const seconds = Math.floor((Date.now() - recordingStartTime) / 1000);
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                recordingTimer.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }

            // Initialize welcome animation
            setTimeout(() => {
                document.querySelector('.welcome-animation').style.opacity = '1';
            }, 500);
        });
    </script>
</body>
</html>
